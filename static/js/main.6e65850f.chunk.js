(this["webpackJsonpvt-react"]=this["webpackJsonpvt-react"]||[]).push([[0],[,,,,function(e,t,n){e.exports={overview:"TripOverview_overview___kW70",origin:"TripOverview_origin__1YlZ5",destination:"TripOverview_destination__guSIV",times:"TripOverview_times__1R_St",invalid:"TripOverview_invalid__1q6Bi",notesIcon:"TripOverview_notesIcon__1nrtU",legs:"TripOverview_legs__1MaC0",travelTime:"TripOverview_travelTime__18eQF",leg:"TripOverview_leg__15Ba1"}},function(e,t,n){e.exports={legs:"TripDetails_legs__3EAG4",leg:"TripDetails_leg__3RYui",direction:"TripDetails_direction__nETYo",track:"TripDetails_track__3u51Y",overview:"TripDetails_overview__3QAnu",location:"TripDetails_location__3weSf",time:"TripDetails_time__3LcKt",name:"TripDetails_name__3k2bV",notes:"TripDetails_notes__2gw9C"}},,function(e,t,n){e.exports={locations:"SearchBar_locations__CSxHQ",datetime:"SearchBar_datetime__2SP0R",search:"SearchBar_search__22_iH",switchLocationsButton:"SearchBar_switchLocationsButton__1Gqfa",switchLocationsIcon:"SearchBar_switchLocationsIcon__1eBNU",searchButton:"SearchBar_searchButton__1GItM",spinnerIcon:"SearchBar_spinnerIcon__2MG7m",searching:"SearchBar_searching__8o1tj"}},,function(e,t,n){e.exports={app:"App_app__1tA9O",navbar:"App_navbar__2AN66",logo:"App_logo__3qVxm",error:"App_error__yS4ld"}},function(e,t,n){e.exports={wrapper:"LocationSearchInput_wrapper__2djFY",icon:"LocationSearchInput_icon__1yItC",input:"LocationSearchInput_input__2QYj6",cancelButton:"LocationSearchInput_cancelButton__392il"}},function(e,t,n){e.exports={result:"SearchResult_result__3HQLu",earlierLaterButtons:"SearchResult_earlierLaterButtons__2UOOe",earlierLaterButton:"SearchResult_earlierLaterButton__15iUV"}},,,,function(e,t,n){e.exports={wrapper:"DatetimeInput_wrapper__XqBGi",nowButton:"DatetimeInput_nowButton__23SMg",nowOverlay:"DatetimeInput_nowOverlay__1vweV"}},function(e,t,n){e.exports={wrapper:"Input_wrapper__2o0fD",input:"Input_input__24dvw",inputIcon:"Input_inputIcon__3Fr-L"}},function(e,t,n){e.exports={wrapper:"LocationInput_wrapper__22Kag",fakeInput:"LocationInput_fakeInput__2YPHy",static:"LocationInput_static__2Xnyu"}},function(e,t,n){e.exports={search:"LocationSearch_search__nxx0-",results:"LocationSearch_results__ypv_A"}},,,function(e,t,n){e.exports={address:"Location_address__1BjE9"}},function(e,t,n){e.exports={list:"LocationList_list__1GHD9"}},function(e,t,n){e.exports={item:"LocationListItem_item__LweBU"}},function(e,t,n){e.exports={list:"TripList_list__UIk8G"}},function(e,t,n){e.exports={item:"TripListItem_item__104lt"}},,function(e,t,n){e.exports=n(38)},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(12),i=n.n(o),c=n(6),s=n.n(c),l=n(1),u=n(3),m=n.n(u),p=n(2),f=n.n(p);function d(e,t,n,a){var r,o,i,c;return s.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return r=m()(a).format("YYYY-MM-DD"),o=m()(a).format("HH:mm"),i="https://api.vasttrafik.se/bin/rest.exe/v2/trip?format=json"+v("origin",t)+v("dest",n)+"&date="+encodeURIComponent(r)+"&time="+encodeURIComponent(o),l.next=5,s.a.awrap(fetch(i,{headers:new Headers({Authorization:"Bearer "+e}),method:"GET"}));case 5:return c=l.sent,l.abrupt("return",c.json());case 7:case"end":return l.stop()}}))}function v(e,t){return t.id?"&"+e+"Id="+encodeURIComponent(t.id):t.lat&&t.lon?"&"+e+"CoordName="+encodeURIComponent(t.name)+"&"+e+"CoordLat="+encodeURIComponent(t.lat)+"&"+e+"CoordLong="+encodeURIComponent(t.lon):""}var h=n(13),_=n(14),g=function(){function e(t,n){Object(h.a)(this,e),this.key=void 0,this.secret=void 0,this.token=void 0,this.key=t,this.secret=n,this.token={expiryDate:0,token:""}}return Object(_.a)(e,[{key:"getToken",value:function(){var e=this;return new Promise((function(t,n){var a=e.getStoredToken();Date.now()<a.expiryDate?t(a.token):e.signIn().then((function(e){return e.json()})).then((function(n){e.token={expiryDate:Date.now()+1e3*Number(n.expires_in),token:n.access_token},e.storeToken(),t(e.token.token)}))}))}},{key:"getStoredToken",value:function(){return{expiryDate:Number(localStorage.getItem("tokenExpiryDate")),token:localStorage.getItem("token")}}},{key:"signIn",value:function(){var e=new Headers({Authorization:"Basic "+btoa(this.key+":"+this.secret),"Content-Type":"application/x-www-form-urlencoded"});return fetch("https://api.vasttrafik.se:443/token",{body:"grant_type=client_credentials&scope="+this.scope(),headers:e,method:"POST"})}},{key:"scope",value:function(){var e=localStorage.getItem("scope");return e||(e=this.generateScope(),localStorage.setItem("scope",e)),e}},{key:"generateScope",value:function(){return Math.random().toString(36).slice(2)}},{key:"storeToken",value:function(){localStorage.setItem("token",this.token.token),localStorage.setItem("tokenExpiryDate",String(this.token.expiryDate))}}]),e}();function w(e,t){var n=Object(a.useState)((function(){return window.localStorage.getItem(e)?JSON.parse(window.localStorage.getItem(e)):t})),r=Object(l.a)(n,2),o=r[0],i=r[1];return[o,function(t){i(t),window.localStorage.setItem(e,JSON.stringify(t))}]}var E="d9k7BQPB7_5nIsjU9d7Y0IkFIqUa",k="Ksgx8WdEnn9gjp9Sqln72WgbQdUa";function N(e){return e?Array.isArray(e)?e:[e]:[]}function S(e){return e<10?"0"+e:""+e}var b=n(9),y=n.n(b),L=n(8),I=n.n(L),O=n(15),C=n.n(O),x=n(16),T=n.n(x),j=function(e){return r.a.createElement("div",{className:T.a.wrapper},r.a.createElement(f.a,{name:e.icon,className:T.a.inputIcon}),r.a.createElement("input",Object.assign({className:T.a.input},e)))},B=function(e){var t=e.date,n=e.now,a=e.onChange,o=e.onNowButtonClick,i=m()(t).format("YYYY-MM-DDTHH:mm:ss");return r.a.createElement("div",{className:C.a.wrapper},r.a.createElement(j,{icon:"calendar-alt",type:"datetime-local",value:i,onChange:function(e){var t=e.target;a(m()(t.value).toDate())}}),n?r.a.createElement("div",{className:C.a.nowOverlay},"Avg\xe5r nu"):r.a.createElement("button",{className:C.a.nowButton,onClick:o},"Nu"))},D=n(20),U=n(21),R=n.n(U),A=function(e){var t=e.name.split(", "),n=Object(l.a)(t,2),a=n[0],o=n[1];return r.a.createElement("div",null,r.a.createElement("div",null,a),o&&r.a.createElement("div",{className:R.a.address},o))},M=n(17),Y=n.n(M),W=n(26),H=function(){function e(t){Object(h.a)(this,e),this.items=void 0,this.limit=void 0,this.limit=t;var n=localStorage.getItem("mru");this.items=n?JSON.parse(n):[]}return Object(_.a)(e,[{key:"add",value:function(e){this.removeExistingItem(e),this.items.unshift(e),this.ensureLengthWithinLimit(),this.setMostRecentlyUsed()}},{key:"getMostRecentlyUsed",value:function(){return this.items}},{key:"setMostRecentlyUsed",value:function(){localStorage.setItem("mru",JSON.stringify(this.items))}},{key:"getFirstMatch",value:function(e){return this.items.find((function(t){return t.name.toLowerCase().startsWith(e.toLowerCase())}))}},{key:"removeExistingItem",value:function(e){var t=this.items.findIndex((function(t){return t.id===e.id}));t>-1&&this.items.splice(t,1)}},{key:"ensureLengthWithinLimit",value:function(){this.items.length>this.limit&&this.items.splice(this.limit,this.items.length-this.limit)}}]),e}(),P=n(22),G=n.n(P),F=n(23),Q=n.n(F),q=function(e){var t=e.location,n=e.onClick;return r.a.createElement("li",{className:Q.a.item,onClick:function(e){e.stopPropagation(),n(t)}},r.a.createElement(A,{name:t.name}))},J=function(e){var t=e.locations,n=e.onSelect;return r.a.createElement("ul",{className:G.a.list},t.map((function(e){return r.a.createElement(q,{location:e,key:e.id||e.name,onClick:n})})))},V=n(18),K=n.n(V),z=n(10),X=n.n(z),$=function(e){var t=e.value,n=e.onChange,a=e.onCancel;return r.a.createElement("div",{className:X.a.wrapper},r.a.createElement("div",{className:X.a.icon},r.a.createElement(f.a,{name:"map-marker-alt"})),r.a.createElement("input",{className:X.a.input,placeholder:"Station",ref:function(e){setTimeout((function(){e&&e.focus()}),0)},type:"text",value:t,onChange:n}),r.a.createElement("button",{className:X.a.cancelButton,onClick:a},"Avbryt"))},Z=function(e){var t=e.onCancel,n=e.onSelect,o=new H(10),i=Object(a.useState)(o.getMostRecentlyUsed()),c=Object(l.a)(i,2),u=c[0],m=c[1],p=Object(a.useState)(""),f=Object(l.a)(p,2),d=f[0],v=f[1],h=Object(a.useState)(),_=Object(l.a)(h,2),w=_[0],S=_[1],b=function(e,t){var n=Object(a.useState)(e),r=Object(l.a)(n,2),o=r[0],i=r[1];return Object(a.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),o}(d,250);function y(e){n(e),e.id&&o.add(e)}return Object(a.useEffect)((function(){b&&new g(E,k).getToken().then((function(e){(function(e,t){var n,a;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n="https://api.vasttrafik.se/bin/rest.exe/v2/location.name?format=json&input="+encodeURIComponent(t),r.next=3,s.a.awrap(fetch(n,{headers:new Headers({Authorization:"Bearer "+e}),method:"GET"}));case 3:return a=r.sent,r.abrupt("return",a.json());case 5:case"end":return r.stop()}}))})(e,b).then((function(e){var t=function(e,t,n){for(var a=[],r=0,o=0;r<e.length&&o<t.length;)a.push(n(e[r],t[o])<=0?e[r++]:t[o++]);for(;r<e.length;)a.push(e[r++]);for(;o<t.length;)a.push(t[o++]);return a}(N(e.LocationList.CoordLocation),N(e.LocationList.StopLocation),(function(e,t){return Number(e.idx)-Number(t.idx)}));m(t)}))}))}),[b]),r.a.createElement("div",{className:K.a.search},r.a.createElement($,{value:d,onChange:function(e){var t=e.target.value;v(t),S(o.getFirstMatch(t)),t||m(o.getMostRecentlyUsed())},onCancel:function(e){e.stopPropagation(),t()}}),function(){if(!u.length&&!w)return null;var e=w?function(e,t){var n=[],a=new Set,r=!0,o=!1,i=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done);r=!0){var l=c.value,u=t(l);a.has(u)||n.push(l),a.add(u)}}catch(m){o=!0,i=m}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}([w].concat(Object(W.a)(u)),(function(e){return e.id||e.name})):u;return r.a.createElement("div",{className:K.a.results},r.a.createElement(J,{locations:e,onSelect:y}))}())},ee=(n(36),function(e){var t=e.children,n=document.createElement("div");return Object(a.useEffect)((function(){var e=document.getElementsByTagName("body")[0],t=document.getElementById("modal-root");return e.classList.add("noscroll"),n.classList.add("modal"),t.appendChild(n),function(){e.classList.remove("noscroll"),t.removeChild(n)}}),[n]),i.a.createPortal(t,n)}),te=function(e){var t=e.disabled,n=e.selected,o=e.onSelect,i=Object(a.useState)(!1),c=Object(l.a)(i,2),s=c[0],u=c[1],m=n.name;function p(){u(!1)}function f(e){u(!1),o(e)}return r.a.createElement("div",{className:Y.a.wrapper},s&&r.a.createElement(ee,null,r.a.createElement(Z,{onCancel:p,onSelect:f})),m&&r.a.createElement(A,{name:m}),r.a.createElement("input",{type:"text",className:I()(Y.a.fakeInput,Object(D.a)({},Y.a.static,!m)),onFocus:function(){u(!t)},placeholder:m?"":"H\xe5llplats"}))},ne=n(7),ae=n.n(ne),re=function(e){var t=e.origin,n=e.dest,a=e.date,o=e.now,i=e.searching,c=e.onDatetimeChange,s=e.onLocationChange,l=e.onLocationSwitch,u=e.onNowButtonClick,m=e.onSearch;return r.a.createElement("div",null,r.a.createElement("div",{className:ae.a.locations},r.a.createElement("div",{className:ae.a.inputs},r.a.createElement(te,{disabled:i,selected:t,onSelect:function(e){s("origin",e)}}),r.a.createElement(te,{disabled:i,selected:n,onSelect:function(e){s("dest",e)}})),r.a.createElement("button",{className:ae.a.switchLocationsButton,onClick:l},r.a.createElement(f.a,{name:"exchange-alt",rotate:90,className:ae.a.switchLocationsIcon}))),r.a.createElement("div",{className:ae.a.datetime},r.a.createElement(B,{date:a,now:o,onChange:c,onNowButtonClick:u})),r.a.createElement("button",{className:ae.a.searchButton,onClick:function(){m()},disabled:i},i?r.a.createElement("span",null,"S\xf6ker...",r.a.createElement(f.a,{className:I()(ae.a.spinnerIcon,"right-icon"),name:"spinner",spin:!0})):r.a.createElement("span",null,"S\xf6k resa")))},oe=n(11),ie=n.n(oe),ce=n(24),se=n.n(ce),le=n(5),ue=n.n(le),me=function(e){var t=e.trip;function n(e){return r.a.createElement("div",{className:ue.a.location},r.a.createElement("div",{className:ue.a.overview},r.a.createElement("div",{className:ue.a.time},e.time),r.a.createElement("div",{className:ue.a.name},e.name),r.a.createElement("div",{className:ue.a.track},e.track&&"L\xe4ge "+e.track)),e.Notes&&r.a.createElement("ul",{className:ue.a.notes},e.Notes.Note.map((function(e,t){return r.a.createElement("li",{key:t},e.$)}))))}return r.a.createElement("ul",{className:ue.a.legs},t.Leg.filter((function(e){return"WALK"!==e.type})).map((function(e,t){return function(e,t){return r.a.createElement("li",{className:ue.a.leg,key:t},n(e.Origin),r.a.createElement("div",{className:ue.a.direction},e.name," mot ",e.direction),n(e.Destination))}(e,t)})))},pe=n(25),fe=n.n(pe),de=n(4),ve=n.n(de),he=function(e){var t,n=e.trip,a=e.onClick,o=(t=n.Leg,t[0]).Origin,i=function(e){return e[e.length-1]}(n.Leg).Destination;function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[r.a.createElement("span",{key:0},null!==(t=e.rtTime)&&void 0!==t?t:e.time,n&&r.a.createElement(f.a,{className:I()(ve.a.notesIcon,"right-icon"),name:"info-circle"})),e.rtTime&&e.time!==e.rtTime&&r.a.createElement("s",{className:I()(ve.a.time,ve.a.invalid),key:1},e.time)]}return r.a.createElement("div",{className:ve.a.overview,onClick:a},r.a.createElement("div",{className:ve.a.origin},r.a.createElement("div",{className:ve.a.times},c(o,null!=o.Notes)),r.a.createElement("div",{className:ve.a.legs},n.Leg.filter((function(e){return e.sname})).map((function(e,t){return function(e,t){return r.a.createElement("span",{className:ve.a.leg,key:t,style:{backgroundColor:e.fgColor,borderColor:"#ffffff"===e.fgColor?"#EE1844":"transparent",color:e.bgColor}},e.sname)}(e,t)})))),r.a.createElement(f.a,{name:"arrow-right"}),r.a.createElement("div",{className:ve.a.destination},r.a.createElement("div",{className:ve.a.times},c(i)),r.a.createElement("div",{className:ve.a.travelTime},"Restid: ",function(e,t){var n=m()("".concat(e.rtDate||e.date," ").concat(e.rtTime||e.time)),a=m()("".concat(t.rtDate||t.date," ").concat(t.rtTime||t.time)),r=a.diff(n,"hour"),o=a.diff(n,"minute")%60;return S(r)+":"+S(o)}(o,i))))},_e=function(e){var t=e.trip,n=Object(a.useState)(!1),o=Object(l.a)(n,2),i=o[0],c=o[1];return r.a.createElement("div",{className:fe.a.item},r.a.createElement(he,{trip:t,onClick:function(){c(!i)}}),i&&r.a.createElement(me,{trip:t}))},ge=function(e){var t=e.trips;return r.a.createElement("ul",{className:se.a.list},t.map((function(e,t){return r.a.createElement("li",{key:t},r.a.createElement(_e,{trip:e}))})))},we=function(e){return r.a.createElement("div",{className:ie.a.result},r.a.createElement(ge,{trips:e.trips}),r.a.createElement("div",{className:ie.a.earlierLaterButtons},r.a.createElement("button",{className:ie.a.earlierLaterButton,onClick:e.onShowEarlier},"Tidigare"),r.a.createElement("button",{className:ie.a.earlierLaterButton,onClick:e.onShowLater},"Senare")))},Ee=function(e){return r.a.createElement("div",{className:y.a.error},e.error)},ke=function(){var e=new g(E,k),t=w("trips",[]),n=Object(l.a)(t,2),o=n[0],i=n[1],c=w("origin",{name:""}),u=Object(l.a)(c,2),p=u[0],v=u[1],h=w("dest",{name:""}),_=Object(l.a)(h,2),S=_[0],b=_[1],L=Object(a.useState)(new Date),I=Object(l.a)(L,2),O=I[0],C=I[1],x=Object(a.useState)(""),T=Object(l.a)(x,2),j=T[0],B=T[1],D=Object(a.useState)(!0),U=Object(l.a)(D,2),R=U[0],A=U[1],M=Object(a.useState)(!1),Y=Object(l.a)(M,2),W=Y[0],H=Y[1];function P(e){C(e),A(!1)}function G(e,t){switch(e){case"dest":b(t);break;case"origin":v(t);break;default:throw new Error("Unknown input name: "+e)}}function F(){A(!0)}function Q(){var e=S;b(p),v(e)}function q(){J(R?new Date:O)}function J(t){var n;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=t||O,B(""),H(!0),i([]),a.prev=4,a.next=7,s.a.awrap(e.getToken());case 7:return n=a.sent,a.t0=V,a.next=11,s.a.awrap(d(n,p,S,t));case 11:a.t1=a.sent,(0,a.t0)(a.t1),a.next=18;break;case 15:a.prev=15,a.t2=a.catch(4),K("N\xe5gonting gick snett.");case 18:case"end":return a.stop()}}),null,null,[[4,15]])}function V(e){var t=e.TripList;t.error?K("Inga resultat funna."):function(e){var t=N(e.Trip),n=!0,a=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var s=o.value;s.Leg=N(s.Leg);var l=!0,u=!1,m=void 0;try{for(var p,f=s.Leg[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){var d=p.value;d.Origin.Notes&&(d.Origin.Notes.Note=N(d.Origin.Notes.Note)),d.Destination.Notes&&(d.Destination.Notes.Note=N(d.Destination.Notes.Note))}}catch(v){u=!0,m=v}finally{try{l||null==f.return||f.return()}finally{if(u)throw m}}}}catch(v){a=!0,r=v}finally{try{n||null==c.return||c.return()}finally{if(a)throw r}}H(!1),i(t)}(t)}function K(e){B(e),H(!1)}function z(){var e=m()(O).subtract(20,"minute").toDate();C(e),J(e)}function X(){var e=m()(O).add(20,"minute").toDate();C(e),J(e)}return r.a.createElement(r.a.StrictMode,null,r.a.createElement("div",{className:y.a.app},r.a.createElement("nav",{className:y.a.navbar},r.a.createElement("button",{onClick:function(){B(""),i([])}},r.a.createElement(f.a,{name:"bus",className:y.a.logo}),"Reaktiv V\xe4sttrafik")),j?r.a.createElement(Ee,{error:j}):o.length?r.a.createElement(we,{trips:o,onShowEarlier:z,onShowLater:X}):r.a.createElement(re,{origin:p,dest:S,date:O,now:R,searching:W,onDatetimeChange:P,onLocationChange:G,onLocationSwitch:Q,onNowButtonClick:F,onSearch:q})))},Ne=(n(37),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function Se(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(r.a.createElement(ke,null),document.getElementById("app-root")),function(e){if("serviceWorker"in navigator){if(new URL("/vasttrafik-react",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vasttrafik-react","/service-worker.js");Ne?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Se(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Se(t,e)}))}}()}],[[27,1,2]]]);
//# sourceMappingURL=main.6e65850f.chunk.js.map