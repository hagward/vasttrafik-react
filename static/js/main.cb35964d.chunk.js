(this["webpackJsonpvt-react"]=this["webpackJsonpvt-react"]||[]).push([[0],[,,,,,,,,,,function(e,t,n){e.exports=n(36)},,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(5),o=n.n(i),c=n(4),s=n.n(c),l=n(1),u=n(3),m=n.n(u),f=n(2),d=n.n(f);function v(e,t,n,a){var r,i,o,c;return s.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return r=m()(a).format("YYYY-MM-DD"),i=m()(a).format("HH:mm"),o="https://api.vasttrafik.se/bin/rest.exe/v2/trip?format=json"+p("origin",t)+p("dest",n)+"&date="+encodeURIComponent(r)+"&time="+encodeURIComponent(i),l.next=5,s.a.awrap(fetch(o,{headers:new Headers({Authorization:"Bearer "+e}),method:"GET"}));case 5:return c=l.sent,l.abrupt("return",c.json());case 7:case"end":return l.stop()}}))}function p(e,t){return t.id?"&"+e+"Id="+encodeURIComponent(t.id):t.lat&&t.lon?"&"+e+"CoordName="+encodeURIComponent(t.name)+"&"+e+"CoordLat="+encodeURIComponent(t.lat)+"&"+e+"CoordLong="+encodeURIComponent(t.lon):""}var h=n(6),g=n(7),E=function(){function e(t,n){Object(h.a)(this,e),this.key=void 0,this.secret=void 0,this.token=void 0,this.key=t,this.secret=n,this.token={expiryDate:0,token:""}}return Object(g.a)(e,[{key:"getToken",value:function(){var e=this;return new Promise((function(t,n){var a=e.getStoredToken();Date.now()<a.expiryDate?t(a.token):e.signIn().then((function(e){return e.json()})).then((function(n){e.token={expiryDate:Date.now()+1e3*Number(n.expires_in),token:n.access_token},e.storeToken(),t(e.token.token)}))}))}},{key:"getStoredToken",value:function(){return{expiryDate:Number(localStorage.getItem("tokenExpiryDate")),token:localStorage.getItem("token")}}},{key:"signIn",value:function(){var e=new Headers({Authorization:"Basic "+btoa(this.key+":"+this.secret),"Content-Type":"application/x-www-form-urlencoded"});return fetch("https://api.vasttrafik.se:443/token",{body:"grant_type=client_credentials&scope="+this.scope(),headers:e,method:"POST"})}},{key:"scope",value:function(){var e=localStorage.getItem("scope");return e||(e=this.generateScope(),localStorage.setItem("scope",e)),e}},{key:"generateScope",value:function(){return Math.random().toString(36).slice(2)}},{key:"storeToken",value:function(){localStorage.setItem("token",this.token.token),localStorage.setItem("tokenExpiryDate",String(this.token.expiryDate))}}]),e}();function k(e,t){var n=Object(a.useState)((function(){return window.localStorage.getItem(e)?JSON.parse(window.localStorage.getItem(e)):t})),r=Object(l.a)(n,2),i=r[0],o=r[1];return[i,function(t){o(t),window.localStorage.setItem(e,JSON.stringify(t))}]}var w="d9k7BQPB7_5nIsjU9d7Y0IkFIqUa",_="Ksgx8WdEnn9gjp9Sqln72WgbQdUa";function N(e){return e?Array.isArray(e)?e:[e]:[]}function b(e){return e<10?"0"+e:""+e}n(19),n(20),n(21);var y=function(e){return r.a.createElement("div",{className:"input"},r.a.createElement(d.a,{name:e.icon}),r.a.createElement("input",Object.assign({className:"input__input"},e)))},S=function(e){var t=e.date,n=e.now,a=e.onChange,i=e.onNowButtonClick,o=m()(t).format("YYYY-MM-DDTHH:mm:ss");return r.a.createElement("div",{className:"datetime-input"},r.a.createElement(y,{className:"input__input",icon:"calendar-alt",type:"datetime-local",value:o,onChange:function(e){var t=e.target;a(m()(t.value).toDate())}}),n?r.a.createElement("div",{className:"datetime-input__now-overlay"},"Avg\xe5r nu"):r.a.createElement("button",{className:"datetime-input__now-button",onClick:i},"Nu"))},C=(n(22),function(e){var t=e.name.split(", "),n=Object(l.a)(t,2),a=n[0],i=n[1];return r.a.createElement("div",{className:"location"},r.a.createElement("div",{className:"location__name"},a),i&&r.a.createElement("div",{className:"location__address"},i))}),O=(n(23),n(9)),j=function(){function e(t){Object(h.a)(this,e),this.items=void 0,this.limit=void 0,this.limit=t;var n=localStorage.getItem("mru");this.items=n?JSON.parse(n):[]}return Object(g.a)(e,[{key:"add",value:function(e){this.removeExistingItem(e),this.items.unshift(e),this.ensureLengthWithinLimit(),this.setMostRecentlyUsed()}},{key:"getMostRecentlyUsed",value:function(){return this.items}},{key:"setMostRecentlyUsed",value:function(){localStorage.setItem("mru",JSON.stringify(this.items))}},{key:"getFirstMatch",value:function(e){return this.items.find((function(t){return t.name.toLowerCase().startsWith(e.toLowerCase())}))}},{key:"removeExistingItem",value:function(e){var t=this.items.findIndex((function(t){return t.id===e.id}));t>-1&&this.items.splice(t,1)}},{key:"ensureLengthWithinLimit",value:function(){this.items.length>this.limit&&this.items.splice(this.limit,this.items.length-this.limit)}}]),e}(),L=(n(24),n(25),function(e){var t=e.location,n=e.onClick;return r.a.createElement("li",{className:"location-list-item",onClick:function(e){e.stopPropagation(),n(t)}},r.a.createElement(C,{name:t.name}))}),x=function(e){var t=e.locations,n=e.onSelect;return r.a.createElement("ul",{className:"location-list"},t.map((function(e){return r.a.createElement(L,{location:e,key:e.id||e.name,onClick:n})})))},I=(n(26),n(27),function(e){var t=e.value,n=e.onChange,a=e.onCancel;return r.a.createElement("div",{className:"location-search-input"},r.a.createElement("div",{className:"location-search-input__icon"},r.a.createElement(d.a,{name:"map-marker-alt"})),r.a.createElement("input",{className:"location-search-input__input",placeholder:"Station",ref:function(e){setTimeout((function(){e&&e.focus()}),0)},type:"text",value:t,onChange:n}),r.a.createElement("button",{className:"location-search-input__cancel",onClick:a},"Avbryt"))}),D=function(e){var t=e.onCancel,n=e.onSelect,i=new E(w,_),o=new j(10),c=Object(a.useState)(o.getMostRecentlyUsed()),u=Object(l.a)(c,2),m=u[0],f=u[1],d=Object(a.useState)(""),v=Object(l.a)(d,2),p=v[0],h=v[1],g=Object(a.useState)(),k=Object(l.a)(g,2),b=k[0],y=k[1],S=function(e,t){var n=Object(a.useState)(e),r=Object(l.a)(n,2),i=r[0],o=r[1];return Object(a.useEffect)((function(){var n=setTimeout((function(){o(e)}),t);return function(){clearTimeout(n)}}),[e,t]),i}(p,250);function C(e){n(e),e.id&&o.add(e)}return Object(a.useEffect)((function(){S&&i.getToken().then((function(e){(function(e,t){var n,a;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return n="https://api.vasttrafik.se/bin/rest.exe/v2/location.name?format=json&input="+encodeURIComponent(t),r.next=3,s.a.awrap(fetch(n,{headers:new Headers({Authorization:"Bearer "+e}),method:"GET"}));case 3:return a=r.sent,r.abrupt("return",a.json());case 5:case"end":return r.stop()}}))})(e,S).then((function(e){var t=function(e,t,n){for(var a=[],r=0,i=0;r<e.length&&i<t.length;)a.push(n(e[r],t[i])<=0?e[r++]:t[i++]);for(;r<e.length;)a.push(e[r++]);for(;i<t.length;)a.push(t[i++]);return a}(N(e.LocationList.CoordLocation),N(e.LocationList.StopLocation),(function(e,t){return Number(e.idx)-Number(t.idx)}));f(t)}))}))}),[i,S]),r.a.createElement("div",{className:"location-search"},r.a.createElement(I,{value:p,onChange:function(e){var t=e.target.value;h(t),y(o.getFirstMatch(t)),t||f(o.getMostRecentlyUsed())},onCancel:function(e){e.stopPropagation(),t()}}),function(){if(!m.length&&!b)return null;var e=b?function(e,t){var n=[],a=new Set,r=!0,i=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done);r=!0){var l=c.value,u=t(l);a.has(u)||n.push(l),a.add(u)}}catch(m){i=!0,o=m}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}([b].concat(Object(O.a)(m)),(function(e){return e.id||e.name})):m;return r.a.createElement("div",{className:"location-search__results"},r.a.createElement(x,{locations:e,onSelect:C}))}())},T=(n(28),function(e){var t=e.children,n=document.createElement("div");return Object(a.useEffect)((function(){var e=document.getElementsByTagName("body")[0],t=document.getElementById("modal-root");return e.classList.add("noscroll"),n.classList.add("modal"),t.appendChild(n),function(){e.classList.remove("noscroll"),t.removeChild(n)}}),[n]),o.a.createPortal(t,n)}),U=function(e){var t=e.disabled,n=e.selected,i=e.onSelect,o=Object(a.useState)(!1),c=Object(l.a)(o,2),s=c[0],u=c[1],m=n.name;function f(){u(!1)}function d(e){u(!1),i(e)}return r.a.createElement("div",{className:"location-input"},s&&r.a.createElement(T,null,r.a.createElement(D,{onCancel:f,onSelect:d})),m&&r.a.createElement(C,{name:m}),r.a.createElement("input",{type:"text",className:"location-input__fake-input"+(m?"":" location-input__fake-input--static"),onFocus:function(){u(!t)},placeholder:m?"":"H\xe5llplats"}))},R=(n(29),function(e){var t=e.origin,n=e.dest,a=e.date,i=e.now,o=e.searching,c=e.onDatetimeChange,s=e.onLocationChange,l=e.onLocationSwitch,u=e.onNowButtonClick,m=e.onSearch;return r.a.createElement("div",{className:"search-bar"},r.a.createElement("div",{className:"search-bar__locations"},r.a.createElement("div",{className:"locations__inputs"},r.a.createElement(U,{disabled:o,selected:t,onSelect:function(e){s("origin",e)}}),r.a.createElement(U,{disabled:o,selected:n,onSelect:function(e){s("dest",e)}})),r.a.createElement("button",{className:"locations__switch-locations",onClick:l},r.a.createElement(d.a,{name:"exchange-alt",rotate:90}))),r.a.createElement("div",{className:"search-bar__datetime"},r.a.createElement(S,{date:a,now:i,onChange:c,onNowButtonClick:u})),r.a.createElement("button",{className:"search-bar__search",onClick:function(){m()},disabled:o},o?r.a.createElement("span",null,"S\xf6ker...",r.a.createElement(d.a,{className:"right-icon",name:"spinner",spin:!0})):r.a.createElement("span",null,"S\xf6k resa")))}),W=(n(30),n(31),n(32),function(e){var t=e.trip;function n(e){return r.a.createElement("div",{className:"trip-details__location"},r.a.createElement("div",{className:"location__overview"},r.a.createElement("div",{className:"location__time"},e.time),r.a.createElement("div",{className:"location__name"},e.name),r.a.createElement("div",{className:"location__track"},e.track&&"L\xe4ge "+e.track)),e.Notes&&r.a.createElement("ul",{className:"location__notes"},e.Notes.Note.map((function(e,t){return r.a.createElement("li",{key:t},e.$)}))))}return r.a.createElement("ul",{className:"trip-details"},t.Leg.filter((function(e){return"WALK"!==e.type})).map((function(e,t){return function(e,t){return r.a.createElement("li",{className:"trip-details__leg",key:t},n(e.Origin),r.a.createElement("div",{className:"trip-details__direction"},e.name," mot ",e.direction),n(e.Destination))}(e,t)})))}),A=(n(33),n(34),function(e){var t,n=e.trip,a=e.onClick,i=(t=n.Leg,t[0]).Origin,o=function(e){return e[e.length-1]}(n.Leg).Destination;function c(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.rtTime?[r.a.createElement("span",{className:"trip-overview__time",key:0},e.rtTime,t&&r.a.createElement(d.a,{className:"right-icon",name:"info-circle"})),e.time!==e.rtTime&&r.a.createElement("s",{className:"trip-overview__time trip-overview__time--invalid",key:1},e.time)]:r.a.createElement("span",{className:"trip-overview__time"},e.time)}return r.a.createElement("div",{className:"trip-overview",onClick:a},r.a.createElement("div",{className:"trip-overview__origin"},r.a.createElement("div",{className:"trip-overview__times"},c(i,null!=i.Notes)),r.a.createElement("div",{className:"trip-overview__legs"},n.Leg.filter((function(e){return e.sname})).map((function(e,t){return function(e,t){return r.a.createElement("span",{className:"trip-overview__leg",key:t,style:{backgroundColor:e.fgColor,borderColor:"#ffffff"===e.fgColor?"#EE1844":"transparent",color:e.bgColor}},e.sname)}(e,t)})))),r.a.createElement("div",{className:"trip-overview__arrow"},r.a.createElement(d.a,{name:"arrow-right"})),r.a.createElement("div",{className:"trip-overview__destination"},r.a.createElement("div",{className:"trip-overview__times"},c(o)),r.a.createElement("div",{className:"trip-overview__travel-time"},"Restid: ",function(e,t){var n=m()("".concat(e.rtDate||e.date," ").concat(e.rtTime||e.time)),a=m()("".concat(t.rtDate||t.date," ").concat(t.rtTime||t.time)),r=a.diff(n,"hour"),i=a.diff(n,"minute")%60;return b(r)+":"+b(i)}(i,o))))}),B=function(e){var t=e.trip,n=Object(a.useState)(!1),i=Object(l.a)(n,2),o=i[0],c=i[1];return r.a.createElement("div",{className:"trip-list-item"},r.a.createElement(A,{trip:t,onClick:function(){c(!o)}}),o&&r.a.createElement(W,{trip:t}))},M=function(e){var t=e.trips;return r.a.createElement("ul",{className:"trip-list"},t.map((function(e,t){return r.a.createElement("li",{key:t,className:"trip-list__trip"},r.a.createElement(B,{trip:e}))})))},Y=function(e){return r.a.createElement("div",{className:"search-result"},r.a.createElement("div",{className:"search-result__trips"},r.a.createElement(M,{trips:e.trips}),r.a.createElement("div",{className:"search-result__earlier-later"},r.a.createElement("button",{className:"earlier-later__button",onClick:e.onShowEarlier},"Tidigare"),r.a.createElement("button",{className:"earlier-later__button",onClick:e.onShowLater},"Senare"))))},H=function(e){return r.a.createElement("div",{className:"app__error"},e.error)},P=function(){var e=new E(w,_),t=k("trips",[]),n=Object(l.a)(t,2),i=n[0],o=n[1],c=k("origin",{name:""}),u=Object(l.a)(c,2),f=u[0],p=u[1],h=k("dest",{name:""}),g=Object(l.a)(h,2),b=g[0],y=g[1],S=Object(a.useState)(new Date),C=Object(l.a)(S,2),O=C[0],j=C[1],L=Object(a.useState)(""),x=Object(l.a)(L,2),I=x[0],D=x[1],T=Object(a.useState)(!0),U=Object(l.a)(T,2),W=U[0],A=U[1],B=Object(a.useState)(!1),M=Object(l.a)(B,2),P=M[0],J=M[1];function F(e){j(e),A(!1)}function z(e,t){switch(e){case"dest":y(t);break;case"origin":p(t);break;default:throw new Error("Unknown input name: "+e)}}function q(){A(!0)}function G(){var e=b;y(f),p(e)}function K(){Q(W?new Date:O)}function Q(t){var n;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=t||O,D(""),J(!0),o([]),a.prev=4,a.next=7,s.a.awrap(e.getToken());case 7:return n=a.sent,a.t0=$,a.next=11,s.a.awrap(v(n,f,b,t));case 11:a.t1=a.sent,(0,a.t0)(a.t1),a.next=18;break;case 15:a.prev=15,a.t2=a.catch(4),V("N\xe5gonting gick snett.");case 18:case"end":return a.stop()}}),null,null,[[4,15]])}function $(e){var t=e.TripList;t.error?V("Inga resultat funna."):function(e){var t=N(e.Trip),n=!0,a=!1,r=void 0;try{for(var i,c=t[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var s=i.value;s.Leg=N(s.Leg);var l=!0,u=!1,m=void 0;try{for(var f,d=s.Leg[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var v=f.value;v.Origin.Notes&&(v.Origin.Notes.Note=N(v.Origin.Notes.Note)),v.Destination.Notes&&(v.Destination.Notes.Note=N(v.Destination.Notes.Note))}}catch(p){u=!0,m=p}finally{try{l||null==d.return||d.return()}finally{if(u)throw m}}}}catch(p){a=!0,r=p}finally{try{n||null==c.return||c.return()}finally{if(a)throw r}}J(!1),o(t)}(t)}function V(e){D(e),J(!1)}function X(){var e=m()(O).subtract(20,"minute").toDate();j(e),Q(e)}function Z(){var e=m()(O).add(20,"minute").toDate();j(e),Q(e)}return r.a.createElement(r.a.StrictMode,null,r.a.createElement("div",{className:"app"},r.a.createElement("nav",{className:"app__nav-bar"},r.a.createElement("button",{onClick:function(){D(""),o([])}},r.a.createElement(d.a,{name:"bus"}),"Reaktiv V\xe4sttrafik")),I?r.a.createElement(H,{error:I}):i.length?r.a.createElement(Y,{trips:i,onShowEarlier:X,onShowLater:Z}):r.a.createElement(R,{origin:f,dest:b,date:O,now:W,searching:P,onDatetimeChange:F,onLocationChange:z,onLocationSwitch:G,onNowButtonClick:q,onSearch:K})))},J=(n(35),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function F(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(r.a.createElement(P,null),document.getElementById("app-root")),function(e){if("serviceWorker"in navigator){if(new URL("/vasttrafik-react",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vasttrafik-react","/service-worker.js");J?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):F(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):F(t,e)}))}}()}],[[10,1,2]]]);
//# sourceMappingURL=main.cb35964d.chunk.js.map