{"version":3,"sources":["api.ts","Auth.ts","hooks.ts","settings.ts","util.ts","components/Input.tsx","components/DatetimeInput.tsx","components/Location.tsx","MruCache.ts","components/LocationListItem.tsx","components/LocationList.tsx","components/LocationSearchInput.tsx","components/LocationSearch.tsx","components/Modal.tsx","components/LocationInput.tsx","components/SearchBar.tsx","components/TripDetails.tsx","components/TripOverview.tsx","components/TripListItem.tsx","components/TripList.tsx","components/SearchResult.tsx","components/App.tsx","serviceWorker.ts","index.tsx"],"names":["searchTrip","token","origin","dest","date","a","async","dateString","dayjs","format","timeString","url","getLocationParameter","encodeURIComponent","fetch","headers","Headers","Authorization","method","response","json","inputName","location","id","lat","lon","name","Auth","key","secret","this","expiryDate","Promise","resolve","reject","storedToken","getStoredToken","Date","now","signIn","then","Number","expires_in","access_token","storeToken","localStorage","getItem","btoa","body","scope","generateScope","setItem","Math","random","toString","slice","String","useLocalStorage","initialValue","useState","window","JSON","parse","item","setInnerValue","value","stringify","list","object","Array","isArray","padNumber","n","Input","props","className","icon","DatetimeInput","onChange","onNowButtonClick","type","event","target","toDate","onClick","Location","split","station","address","MruCache","limit","items","mru","removeExistingItem","unshift","ensureLengthWithinLimit","setMostRecentlyUsed","searchString","find","toLowerCase","startsWith","existingIndex","findIndex","existingItem","splice","length","LocationListItem","stopPropagation","LocationList","locations","onSelect","map","LocationSearchInput","onCancel","placeholder","ref","input","setTimeout","focus","LocationSearch","auth","settings","recentLocations","getMostRecentlyUsed","locationState","setLocationState","searchValue","setSearchValue","quickLocation","setQuickLocation","debouncedSearchValue","delay","debouncedValue","setDebouncedValue","useEffect","handler","clearTimeout","useDebounce","handleSelect","add","getToken","searchLocation","b","compare","result","i","j","push","merge","CoordLocation","StopLocation","idx","getFirstMatch","allLocations","array","set","Set","itemId","has","removeDuplicates","renderResults","Modal","children","el","document","createElement","getElementsByTagName","modalRoot","getElementById","classList","appendChild","remove","removeChild","ReactDOM","createPortal","LocationInput","disabled","selected","overlay","setOverlay","handleCancel","onFocus","SearchBar","searching","onDatetimeChange","onLocationChange","onLocationSwitch","onSearch","rotate","spin","TripDetails","trip","renderLocation","time","track","Notes","Note","note","index","$","Leg","filter","leg","Origin","direction","Destination","renderLeg","TripOverview","destination","last","renderTime","renderInfoIcon","rtTime","sname","style","backgroundColor","fgColor","borderColor","color","bgColor","start","end","startDate","rtDate","endDate","hourDiff","diff","minuteDiff","travelTime","TripListItem","expanded","setExpanded","TripList","trips","tripIndex","SearchResult","onShowEarlier","onShowLater","ErrorMessage","error","App","tripsState","setTripsState","originState","setOriginState","destState","setDestState","dateState","setDateState","errorState","setErrorState","nowState","setNowState","searchingState","setSearchingState","handleDatetimeChange","handleLocationChange","Error","handleNowButtonClick","switchLocations","currentDest","handleSearch","search","parseResponse","parseError","tripList","Trip","parseTrips","findEarlierTrips","newDate","subtract","findLaterTrips","StrictMode","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","render","URL","process","href","addEventListener","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.cb35964d.chunk.js","sourcesContent":["import dayjs from \"dayjs\";\n\nexport interface Trip {\n  Leg: Leg[];\n}\n\nexport interface Leg {\n  Origin: Location;\n  Destination: Location;\n  direction: string;\n  name: string;\n  sname: string;\n  fgColor: string;\n  bgColor: string;\n  type: string;\n}\n\nexport interface Location {\n  date: string;\n  name: string;\n  Notes?: { Note: Note[] };\n  rtDate?: string;\n  rtTime?: string;\n  time: string;\n  track?: string;\n}\n\ninterface Note {\n  $: string;\n  key: string;\n  priority: string;\n  severity: string;\n}\n\nexport interface CoordLocation {\n  id?: string;\n  idx?: string;\n  lat?: string;\n  lon?: string;\n  name: string;\n}\n\nexport interface StopLocation extends CoordLocation {\n  id: string;\n}\n\nexport async function searchLocation(token: string, searchString: string) {\n  const url =\n    \"https://api.vasttrafik.se/bin/rest.exe/v2/location.name\" +\n    \"?format=json&input=\" +\n    encodeURIComponent(searchString);\n\n  const response = await fetch(url, {\n    headers: new Headers({ Authorization: \"Bearer \" + token }),\n    method: \"GET\"\n  });\n  return response.json();\n}\n\nexport async function searchTrip(\n  token: string,\n  origin: CoordLocation,\n  dest: CoordLocation,\n  date: Date\n) {\n  const dateString = dayjs(date).format(\"YYYY-MM-DD\");\n  const timeString = dayjs(date).format(\"HH:mm\");\n  const url =\n    \"https://api.vasttrafik.se/bin/rest.exe/v2/trip?format=json\" +\n    getLocationParameter(\"origin\", origin) +\n    getLocationParameter(\"dest\", dest) +\n    \"&date=\" +\n    encodeURIComponent(dateString) +\n    \"&time=\" +\n    encodeURIComponent(timeString);\n\n  const response = await fetch(url, {\n    headers: new Headers({ Authorization: \"Bearer \" + token }),\n    method: \"GET\"\n  });\n  return response.json();\n}\n\nfunction getLocationParameter(\n  inputName: string,\n  location: CoordLocation\n): string {\n  if (location.id) {\n    return \"&\" + inputName + \"Id=\" + encodeURIComponent(location.id);\n  } else if (location.lat && location.lon) {\n    return (\n      \"&\" +\n      inputName +\n      \"CoordName=\" +\n      encodeURIComponent(location.name) +\n      \"&\" +\n      inputName +\n      \"CoordLat=\" +\n      encodeURIComponent(location.lat) +\n      \"&\" +\n      inputName +\n      \"CoordLong=\" +\n      encodeURIComponent(location.lon)\n    );\n  } else {\n    return \"\";\n  }\n}\n","interface AuthToken {\n  expiryDate: number;\n  token: string;\n}\n\nexport default class Auth {\n  private key: string;\n  private secret: string;\n  private token: AuthToken;\n\n  constructor(key: string, secret: string) {\n    this.key = key;\n    this.secret = secret;\n    this.token = {\n      expiryDate: 0,\n      token: \"\"\n    };\n  }\n\n  public getToken(): Promise<string> {\n    return new Promise<string>((resolve, reject) => {\n      const storedToken = this.getStoredToken();\n      if (Date.now() < storedToken.expiryDate) {\n        resolve(storedToken.token);\n      } else {\n        this.signIn()\n          .then(response => response.json())\n          .then(json => {\n            this.token = {\n              expiryDate: Date.now() + Number(json.expires_in) * 1000,\n              token: json.access_token\n            };\n            this.storeToken();\n\n            resolve(this.token.token);\n          });\n      }\n    });\n  }\n\n  private getStoredToken(): AuthToken {\n    return {\n      expiryDate: Number(localStorage.getItem(\"tokenExpiryDate\")),\n      token: localStorage.getItem(\"token\") as string\n    };\n  }\n\n  private signIn(): Promise<Response> {\n    const headers = new Headers({\n      Authorization: \"Basic \" + btoa(this.key + \":\" + this.secret),\n      \"Content-Type\": \"application/x-www-form-urlencoded\"\n    });\n\n    return fetch(\"https://api.vasttrafik.se:443/token\", {\n      body: \"grant_type=client_credentials&scope=\" + this.scope(),\n      headers,\n      method: \"POST\"\n    });\n  }\n\n  private scope(): string {\n    let scope = localStorage.getItem(\"scope\");\n    if (!scope) {\n      scope = this.generateScope();\n      localStorage.setItem(\"scope\", scope);\n    }\n    return scope;\n  }\n\n  private generateScope(): string {\n    return Math.random()\n      .toString(36)\n      .slice(2);\n  }\n\n  private storeToken(): void {\n    localStorage.setItem(\"token\", this.token.token);\n    localStorage.setItem(\"tokenExpiryDate\", String(this.token.expiryDate));\n  }\n}\n","import { useEffect, useState } from \"react\";\n\n// https://usehooks.com/\nexport function useLocalStorage(key: string, initialValue: any) {\n  const [item, setInnerValue] = useState(() =>\n    window.localStorage.getItem(key)\n      ? JSON.parse(window.localStorage.getItem(key)!)\n      : initialValue\n  );\n\n  const setValue = (value: any) => {\n    setInnerValue(value);\n    window.localStorage.setItem(key, JSON.stringify(value));\n  };\n\n  return [item, setValue];\n}\n\n// https://dev.to/gabe_ragland/debouncing-with-react-hooks-jci\nexport default function useDebounce(value: any, delay: number) {\n  const [debouncedValue, setDebouncedValue] = useState(value);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedValue(value);\n    }, delay);\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [value, delay]);\n\n  return debouncedValue;\n}\n","export default {\n  key: 'd9k7BQPB7_5nIsjU9d7Y0IkFIqUa',\n  secret: 'Ksgx8WdEnn9gjp9Sqln72WgbQdUa',\n};\n","export function list<T>(object: T): T[] {\n  if (!object) {\n    return [];\n  }\n  return Array.isArray(object) ? object : [object];\n}\n\nexport function first<T>(array: T[]): T {\n  return array[0];\n}\n\nexport function last<T>(array: T[]): T {\n  return array[array.length - 1];\n}\n\nexport function merge<T>(\n  a: T[],\n  b: T[],\n  compare: (e1: T, e2: T) => number\n): T[] {\n  const result = [];\n  let i = 0;\n  let j = 0;\n  while (i < a.length && j < b.length) {\n    result.push(compare(a[i], b[j]) <= 0 ? a[i++] : b[j++]);\n  }\n  while (i < a.length) {\n    result.push(a[i++]);\n  }\n  while (j < b.length) {\n    result.push(b[j++]);\n  }\n  return result;\n}\n\nexport function removeDuplicates<T>(array: T[], id: (e: T) => string): T[] {\n  const result: T[] = [];\n  const set = new Set<string>();\n  for (const item of array) {\n    const itemId = id(item);\n    if (!set.has(itemId)) {\n      result.push(item);\n    }\n    set.add(itemId);\n  }\n  return result;\n}\n\nexport function shortLocation(locationName: string): string {\n  return locationName.split(\",\")[0];\n}\n\nexport function padNumber(n: number): string {\n  return n < 10 ? \"0\" + n : \"\" + n;\n}\n","import React from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport \"./Input.css\";\n\ninterface Props {\n  className?: string;\n  icon: string;\n  placeholder?: string;\n  readOnly?: boolean;\n  type: string;\n  value: string;\n  onChange?(event: React.FormEvent<HTMLInputElement>): any;\n  onFocus?(event: React.FocusEvent<HTMLInputElement>): any;\n}\n\nexport const Input = (props: Props) => {\n  return (\n    <div className=\"input\">\n      <FontAwesome name={props.icon} />\n      <input className=\"input__input\" {...props} />\n    </div>\n  );\n};\n","import dayjs from \"dayjs\";\nimport React from \"react\";\nimport \"./DatetimeInput.css\";\nimport { Input } from \"./Input\";\n\ninterface Props {\n  date: Date;\n  now: boolean;\n  onChange(date: Date): void;\n  onNowButtonClick(): void;\n}\n\nexport const DatetimeInput = ({\n  date,\n  now,\n  onChange,\n  onNowButtonClick\n}: Props) => {\n  const value = dayjs(date).format(\"YYYY-MM-DDTHH:mm:ss\");\n\n  function renderNowOverlay() {\n    return <div className=\"datetime-input__now-overlay\">Avgår nu</div>;\n  }\n\n  function renderNowButton() {\n    return (\n      <button className=\"datetime-input__now-button\" onClick={onNowButtonClick}>\n        Nu\n      </button>\n    );\n  }\n\n  function handleChange(event: React.FormEvent<HTMLInputElement>) {\n    const target = event.target as HTMLInputElement;\n    onChange(dayjs(target.value).toDate());\n  }\n\n  return (\n    <div className=\"datetime-input\">\n      <Input\n        className=\"input__input\"\n        icon=\"calendar-alt\"\n        type=\"datetime-local\"\n        value={value}\n        onChange={handleChange}\n      />\n      {now ? renderNowOverlay() : renderNowButton()}\n    </div>\n  );\n};\n","import React from \"react\";\nimport \"./Location.css\";\n\ninterface Props {\n  name: string;\n}\n\nexport const Location = ({ name }: Props) => {\n  const [station, address] = name.split(\", \");\n  return (\n    <div className=\"location\">\n      <div className=\"location__name\">{station}</div>\n      {address && <div className=\"location__address\">{address}</div>}\n    </div>\n  );\n};\n","interface CacheItem {\n  id: string;\n  name: string;\n}\n\nexport default class MruCache<T extends CacheItem> {\n  private items: T[];\n  private limit: number;\n\n  constructor(limit: number) {\n    this.limit = limit;\n\n    const mru = localStorage.getItem(\"mru\");\n    this.items = mru ? JSON.parse(mru) : [];\n  }\n\n  public add(item: T): void {\n    this.removeExistingItem(item);\n    this.items.unshift(item);\n    this.ensureLengthWithinLimit();\n    this.setMostRecentlyUsed();\n  }\n\n  public getMostRecentlyUsed(): T[] {\n    return this.items;\n  }\n\n  public setMostRecentlyUsed(): void {\n    localStorage.setItem(\"mru\", JSON.stringify(this.items));\n  }\n\n  public getFirstMatch(searchString: string): T | undefined {\n    return this.items.find(item =>\n      item.name.toLowerCase().startsWith(searchString.toLowerCase())\n    );\n  }\n\n  private removeExistingItem(item: T): void {\n    const existingIndex = this.items.findIndex(\n      existingItem => existingItem.id === item.id\n    );\n    if (existingIndex > -1) {\n      this.items.splice(existingIndex, 1);\n    }\n  }\n\n  private ensureLengthWithinLimit(): void {\n    if (this.items.length > this.limit) {\n      this.items.splice(this.limit, this.items.length - this.limit);\n    }\n  }\n}\n","import React from \"react\";\nimport { CoordLocation } from \"../api\";\nimport { Location } from \"./Location\";\nimport \"./LocationListItem.css\";\n\ninterface Props {\n  location: CoordLocation;\n  onClick(location: CoordLocation): any;\n}\n\nexport const LocationListItem = ({ location, onClick }: Props) => {\n  function handleClick(event: React.MouseEvent<HTMLElement>) {\n    event.stopPropagation();\n    onClick(location);\n  }\n\n  return (\n    <li className=\"location-list-item\" onClick={handleClick}>\n      <Location name={location.name} />\n    </li>\n  );\n};\n","import React from \"react\";\nimport { CoordLocation } from \"../api\";\nimport \"./LocationList.css\";\nimport { LocationListItem } from \"./LocationListItem\";\n\ninterface Props {\n  locations: CoordLocation[];\n  onSelect(location: CoordLocation): any;\n}\n\nexport const LocationList = ({ locations, onSelect }: Props) => {\n  return (\n    <ul className=\"location-list\">\n      {locations.map(location => (\n        <LocationListItem\n          location={location}\n          key={location.id || location.name}\n          onClick={onSelect}\n        />\n      ))}\n    </ul>\n  );\n};\n","import React from \"react\";\r\nimport FontAwesome from \"react-fontawesome\";\r\nimport \"./LocationSearchInput.css\";\r\n\r\ninterface Props {\r\n  value: string;\r\n  onChange(event: React.FormEvent<HTMLInputElement>): void;\r\n  onCancel(event: React.MouseEvent<HTMLElement>): void;\r\n}\r\n\r\nexport const LocationSearchInput = ({ value, onChange, onCancel }: Props) => {\r\n  function focusInput(input: HTMLInputElement) {\r\n    setTimeout(() => {\r\n      if (input) {\r\n        input.focus();\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  return (\r\n    <div className=\"location-search-input\">\r\n      <div className=\"location-search-input__icon\">\r\n        <FontAwesome name=\"map-marker-alt\" />\r\n      </div>\r\n      <input\r\n        className=\"location-search-input__input\"\r\n        placeholder=\"Station\"\r\n        ref={focusInput}\r\n        type=\"text\"\r\n        value={value}\r\n        onChange={onChange}\r\n      />\r\n      <button className=\"location-search-input__cancel\" onClick={onCancel}>\r\n        Avbryt\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useEffect, useState } from \"react\";\nimport { CoordLocation, StopLocation, searchLocation } from \"../api\";\nimport Auth from \"../Auth\";\nimport useDebounce from \"../hooks\";\nimport MruCache from \"../MruCache\";\nimport settings from \"../settings\";\nimport { list, merge, removeDuplicates } from \"../util\";\nimport { LocationList } from \"./LocationList\";\nimport \"./LocationSearch.css\";\nimport { LocationSearchInput } from \"./LocationSearchInput\";\n\ninterface Props {\n  onCancel(): void;\n  onSelect(location: CoordLocation): void;\n}\n\nexport const LocationSearch = ({ onCancel, onSelect }: Props) => {\n  const auth: Auth = new Auth(settings.key, settings.secret);\n  const recentLocations: MruCache<StopLocation> = new MruCache(10);\n\n  const [locationState, setLocationState] = useState<CoordLocation[]>(\n    recentLocations.getMostRecentlyUsed()\n  );\n  const [searchValue, setSearchValue] = useState(\"\");\n  const [quickLocation, setQuickLocation] = useState<\n    CoordLocation | undefined\n  >();\n\n  const debouncedSearchValue = useDebounce(searchValue, 250);\n\n  useEffect(() => {\n    if (!debouncedSearchValue) {\n      return;\n    }\n\n    auth.getToken().then(token => {\n      searchLocation(token, debouncedSearchValue).then(response => {\n        const coordLocations = list(response.LocationList.CoordLocation);\n        const stopLocations = list(response.LocationList.StopLocation);\n        const locations = merge(\n          coordLocations,\n          stopLocations,\n          (a: CoordLocation, b: CoordLocation) => Number(a.idx) - Number(b.idx)\n        );\n        setLocationState(locations);\n      });\n    });\n  }, [auth, debouncedSearchValue]);\n\n  function renderResults() {\n    if (!locationState.length && !quickLocation) {\n      return null;\n    }\n\n    const allLocations: CoordLocation[] = quickLocation\n      ? removeDuplicates(\n          [quickLocation, ...locationState],\n          location => location.id || location.name\n        )\n      : locationState;\n\n    return (\n      <div className=\"location-search__results\">\n        <LocationList locations={allLocations} onSelect={handleSelect} />\n      </div>\n    );\n  }\n\n  function handleChange(event: React.FormEvent<HTMLInputElement>) {\n    const target = event.target as HTMLInputElement;\n    const value = target.value;\n\n    setSearchValue(value);\n    setQuickLocation(recentLocations.getFirstMatch(value));\n\n    if (!value) {\n      showMostRecentlyUsed();\n    }\n  }\n\n  function showMostRecentlyUsed() {\n    setLocationState(recentLocations.getMostRecentlyUsed());\n  }\n\n  function handleCancel(event: React.MouseEvent<HTMLElement>) {\n    event.stopPropagation();\n    onCancel();\n  }\n\n  function handleSelect(location: CoordLocation) {\n    onSelect(location);\n    if (location.id) {\n      recentLocations.add(location as StopLocation);\n    }\n  }\n\n  return (\n    <div className=\"location-search\">\n      <LocationSearchInput\n        value={searchValue}\n        onChange={handleChange}\n        onCancel={handleCancel}\n      />\n      {renderResults()}\n    </div>\n  );\n};\n","import { useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./Modal.css\";\n\nexport const Modal = ({ children }: any) => {\n  const el: HTMLDivElement = document.createElement(\"div\");\n\n  useEffect(() => {\n    const body = document.getElementsByTagName(\"body\")[0] as HTMLBodyElement;\n    const modalRoot = document.getElementById(\"modal-root\") as HTMLDivElement;\n\n    body.classList.add(\"noscroll\");\n    el.classList.add(\"modal\");\n    modalRoot.appendChild(el);\n\n    return () => {\n      body.classList.remove(\"noscroll\");\n      modalRoot.removeChild(el);\n    };\n  }, [el]);\n\n  return ReactDOM.createPortal(children, el);\n};\n","import React, { useState } from \"react\";\nimport { CoordLocation } from \"../api\";\nimport { Location } from \"./Location\";\nimport \"./LocationInput.css\";\nimport { LocationSearch } from \"./LocationSearch\";\nimport { Modal } from \"./Modal\";\n\ninterface Props {\n  disabled: boolean;\n  selected: CoordLocation;\n  onSelect(location: CoordLocation): any;\n}\n\nexport const LocationInput = ({ disabled, selected, onSelect }: Props) => {\n  const [overlay, setOverlay] = useState(false);\n  const name = selected.name;\n\n  function renderOverlay() {\n    return (\n      <Modal>\n        <LocationSearch onCancel={handleCancel} onSelect={handleSelect} />\n      </Modal>\n    );\n  }\n\n  function handleFocus() {\n    setOverlay(true && !disabled);\n  }\n\n  function handleCancel() {\n    setOverlay(false);\n  }\n\n  function handleSelect(location: CoordLocation) {\n    setOverlay(false);\n    onSelect(location);\n  }\n\n  return (\n    <div className=\"location-input\">\n      {overlay && renderOverlay()}\n      {name && <Location name={name} />}\n      <input\n        type=\"text\"\n        className={\n          \"location-input__fake-input\" +\n          (!name ? \" location-input__fake-input--static\" : \"\")\n        }\n        onFocus={handleFocus}\n        placeholder={!name ? \"Hållplats\" : \"\"}\n      />\n    </div>\n  );\n};\n","import React from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport { CoordLocation } from \"../api\";\nimport { DatetimeInput } from \"./DatetimeInput\";\nimport { LocationInput } from \"./LocationInput\";\nimport \"./SearchBar.css\";\n\ninterface Props {\n  origin: CoordLocation;\n  dest: CoordLocation;\n  date: Date;\n  now: boolean;\n  searching: boolean;\n  onDatetimeChange(date: Date): any;\n  onLocationChange(inputName: string, location: CoordLocation): any;\n  onLocationSwitch(): any;\n  onNowButtonClick(): void;\n  onSearch(): any;\n}\n\nexport const SearchBar = ({\n  origin,\n  dest,\n  date,\n  now,\n  searching,\n  onDatetimeChange,\n  onLocationChange,\n  onLocationSwitch,\n  onNowButtonClick,\n  onSearch\n}: Props) => {\n  function onOriginSelected(location: CoordLocation) {\n    onLocationChange(\"origin\", location);\n  }\n\n  function onDestinationSelected(location: CoordLocation) {\n    onLocationChange(\"dest\", location);\n  }\n\n  function search() {\n    onSearch();\n  }\n\n  return (\n    <div className=\"search-bar\">\n      <div className=\"search-bar__locations\">\n        <div className=\"locations__inputs\">\n          <LocationInput\n            disabled={searching}\n            selected={origin}\n            onSelect={onOriginSelected}\n          />\n          <LocationInput\n            disabled={searching}\n            selected={dest}\n            onSelect={onDestinationSelected}\n          />\n        </div>\n        <button\n          className=\"locations__switch-locations\"\n          onClick={onLocationSwitch}\n        >\n          <FontAwesome name=\"exchange-alt\" rotate={90} />\n        </button>\n      </div>\n      <div className=\"search-bar__datetime\">\n        <DatetimeInput\n          date={date}\n          now={now}\n          onChange={onDatetimeChange}\n          onNowButtonClick={onNowButtonClick}\n        />\n      </div>\n      <button\n        className=\"search-bar__search\"\n        onClick={search}\n        disabled={searching}\n      >\n        {searching ? (\n          <span>\n            Söker...\n            <FontAwesome className=\"right-icon\" name=\"spinner\" spin={true} />\n          </span>\n        ) : (\n          <span>Sök resa</span>\n        )}\n      </button>\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Leg, Location, Trip } from \"../api\";\nimport \"./TripDetails.css\";\n\ninterface Props {\n  trip: Trip;\n}\n\nexport const TripDetails = ({ trip }: Props) => {\n  function renderLegs() {\n    return trip.Leg.filter(leg => leg.type !== \"WALK\").map((leg, index) =>\n      renderLeg(leg, index)\n    );\n  }\n\n  function renderLeg(leg: Leg, index: number) {\n    return (\n      <li className=\"trip-details__leg\" key={index}>\n        {renderLocation(leg.Origin)}\n        <div className=\"trip-details__direction\">\n          {leg.name} mot {leg.direction}\n        </div>\n        {renderLocation(leg.Destination)}\n      </li>\n    );\n  }\n\n  function renderLocation(location: Location) {\n    return (\n      <div className=\"trip-details__location\">\n        <div className=\"location__overview\">\n          <div className=\"location__time\">{location.time}</div>\n          <div className=\"location__name\">{location.name}</div>\n          <div className=\"location__track\">\n            {location.track && \"Läge \" + location.track}\n          </div>\n        </div>\n        {location.Notes && (\n          <ul className=\"location__notes\">\n            {location.Notes.Note.map((note, index) => (\n              <li key={index}>{note.$}</li>\n            ))}\n          </ul>\n        )}\n      </div>\n    );\n  }\n\n  return <ul className=\"trip-details\">{renderLegs()}</ul>;\n};\n","import dayjs from \"dayjs\";\nimport React from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport { Leg, Location, Trip } from \"../api\";\nimport { first, last, padNumber } from \"../util\";\nimport \"./TripOverview.css\";\n\ninterface Props {\n  trip: Trip;\n  onClick(): void;\n}\n\nexport const TripOverview = ({ trip, onClick }: Props) => {\n  const origin = first(trip.Leg).Origin;\n  const destination = last(trip.Leg).Destination;\n\n  function renderTime(location: Location, renderInfoIcon = false) {\n    if (!location.rtTime) {\n      return <span className=\"trip-overview__time\">{location.time}</span>;\n    }\n    return [\n      <span className=\"trip-overview__time\" key={0}>\n        {location.rtTime}\n        {renderInfoIcon && (\n          <FontAwesome className=\"right-icon\" name=\"info-circle\" />\n        )}\n      </span>,\n      location.time !== location.rtTime && (\n        <s className=\"trip-overview__time trip-overview__time--invalid\" key={1}>\n          {location.time}\n        </s>\n      )\n    ];\n  }\n\n  function renderLegs() {\n    return trip.Leg.filter(leg => leg.sname).map((leg, index) =>\n      renderLeg(leg, index)\n    );\n  }\n\n  function renderLeg(leg: Leg, index: number) {\n    return (\n      <span\n        className=\"trip-overview__leg\"\n        key={index}\n        style={{\n          backgroundColor: leg.fgColor,\n          borderColor: leg.fgColor === \"#ffffff\" ? \"#EE1844\" : \"transparent\",\n          color: leg.bgColor\n        }}\n      >\n        {leg.sname}\n      </span>\n    );\n  }\n\n  function travelTime(start: Location, end: Location) {\n    const startDate = dayjs(\n      `${start.rtDate || start.date} ${start.rtTime || start.time}`\n    );\n    const endDate = dayjs(\n      `${end.rtDate || end.date} ${end.rtTime || end.time}`\n    );\n    const hourDiff = endDate.diff(startDate, \"hour\");\n    const minuteDiff = endDate.diff(startDate, \"minute\") % 60;\n    return padNumber(hourDiff) + \":\" + padNumber(minuteDiff);\n  }\n\n  function showInfoIcon(location: Location) {\n    return location.Notes != null;\n  }\n\n  return (\n    <div className=\"trip-overview\" onClick={onClick}>\n      <div className=\"trip-overview__origin\">\n        <div className=\"trip-overview__times\">\n          {renderTime(origin, showInfoIcon(origin))}\n        </div>\n        <div className=\"trip-overview__legs\">{renderLegs()}</div>\n      </div>\n      <div className=\"trip-overview__arrow\">\n        <FontAwesome name=\"arrow-right\" />\n      </div>\n      <div className=\"trip-overview__destination\">\n        <div className=\"trip-overview__times\">{renderTime(destination)}</div>\n        <div className=\"trip-overview__travel-time\">\n          Restid: {travelTime(origin, destination)}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React, { useState } from \"react\";\nimport { Trip } from \"../api\";\nimport { TripDetails } from \"./TripDetails\";\nimport \"./TripListItem.css\";\nimport { TripOverview } from \"./TripOverview\";\n\ninterface Props {\n  trip: Trip;\n}\n\nexport const TripListItem = ({ trip }: Props) => {\n  const [expanded, setExpanded] = useState(false);\n\n  function handleClick() {\n    setExpanded(!expanded);\n  }\n\n  return (\n    <div className=\"trip-list-item\">\n      <TripOverview trip={trip} onClick={handleClick} />\n      {expanded && <TripDetails trip={trip} />}\n    </div>\n  );\n};\n","import React from \"react\";\nimport { Trip } from \"../api\";\nimport \"./TripList.css\";\nimport { TripListItem } from \"./TripListItem\";\n\ninterface Props {\n  trips: Trip[];\n}\n\nexport const TripList = ({ trips }: Props) => {\n  return (\n    <ul className=\"trip-list\">\n      {trips.map((trip, tripIndex) => (\n        <li key={tripIndex} className=\"trip-list__trip\">\n          <TripListItem trip={trip} />\n        </li>\n      ))}\n    </ul>\n  );\n};\n","import React from \"react\";\nimport { Trip } from \"../api\";\nimport \"./SearchResult.css\";\nimport { TripList } from \"./TripList\";\n\ninterface Props {\n  trips: Trip[];\n  onShowEarlier(): void;\n  onShowLater(): void;\n}\n\nexport const SearchResult = (props: Props) => {\n  return (\n    <div className=\"search-result\">\n      <div className=\"search-result__trips\">\n        <TripList trips={props.trips} />\n        <div className=\"search-result__earlier-later\">\n          <button\n            className=\"earlier-later__button\"\n            onClick={props.onShowEarlier}\n          >\n            Tidigare\n          </button>\n          <button className=\"earlier-later__button\" onClick={props.onShowLater}>\n            Senare\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import dayjs from \"dayjs\";\nimport React, { useState } from \"react\";\nimport FontAwesome from \"react-fontawesome\";\nimport { CoordLocation, searchTrip } from \"../api\";\nimport Auth from \"../Auth\";\nimport { useLocalStorage } from \"../hooks\";\nimport settings from \"../settings\";\nimport { list } from \"../util\";\nimport \"./App.css\";\nimport { SearchBar } from \"./SearchBar\";\nimport { SearchResult } from \"./SearchResult\";\n\nconst ErrorMessage = (props: { error: string }) => (\n  <div className=\"app__error\">{props.error}</div>\n);\n\nconst App: React.FC = () => {\n  const auth: Auth = new Auth(settings.key, settings.secret);\n\n  const [tripsState, setTripsState] = useLocalStorage(\"trips\", []);\n  const [originState, setOriginState] = useLocalStorage(\"origin\", { name: \"\" });\n  const [destState, setDestState] = useLocalStorage(\"dest\", { name: \"\" });\n\n  const [dateState, setDateState] = useState(new Date());\n  const [errorState, setErrorState] = useState(\"\");\n  const [nowState, setNowState] = useState(true);\n  const [searchingState, setSearchingState] = useState(false);\n\n  function handleNavBarClick() {\n    setErrorState(\"\");\n    setTripsState([]);\n  }\n\n  function renderMainContent() {\n    if (errorState) {\n      return <ErrorMessage error={errorState} />;\n    } else if (tripsState.length) {\n      return renderSearchResult();\n    } else {\n      return renderSearchBar();\n    }\n  }\n\n  function renderSearchBar() {\n    return (\n      <SearchBar\n        origin={originState}\n        dest={destState}\n        date={dateState}\n        now={nowState}\n        searching={searchingState}\n        onDatetimeChange={handleDatetimeChange}\n        onLocationChange={handleLocationChange}\n        onLocationSwitch={switchLocations}\n        onNowButtonClick={handleNowButtonClick}\n        onSearch={handleSearch}\n      />\n    );\n  }\n\n  function renderSearchResult() {\n    return (\n      <SearchResult\n        trips={tripsState}\n        onShowEarlier={findEarlierTrips}\n        onShowLater={findLaterTrips}\n      />\n    );\n  }\n\n  function handleDatetimeChange(date: Date) {\n    setDateState(date);\n    setNowState(false);\n  }\n\n  function handleLocationChange(inputName: string, location: CoordLocation) {\n    switch (inputName) {\n      case \"dest\":\n        setDestState(location);\n        break;\n      case \"origin\":\n        setOriginState(location);\n        break;\n      default:\n        throw new Error(\"Unknown input name: \" + inputName);\n    }\n  }\n\n  function handleNowButtonClick() {\n    setNowState(true);\n  }\n\n  function switchLocations() {\n    const currentDest = destState;\n\n    setDestState(originState);\n    setOriginState(currentDest);\n  }\n\n  function handleSearch() {\n    search(nowState ? new Date() : dateState);\n  }\n\n  async function search(date?: Date) {\n    date = date || dateState;\n\n    setErrorState(\"\");\n    setSearchingState(true);\n    setTripsState([]);\n\n    try {\n      const token = await auth.getToken();\n      parseResponse(await searchTrip(token, originState, destState, date));\n    } catch {\n      parseError(\"Någonting gick snett.\");\n    }\n  }\n\n  function parseResponse(response: any): void {\n    const tripList = response.TripList;\n    if (tripList.error) {\n      parseError(\"Inga resultat funna.\");\n    } else {\n      parseTrips(tripList);\n    }\n  }\n\n  function parseError(error: string): void {\n    setErrorState(error);\n    setSearchingState(false);\n  }\n\n  function parseTrips(tripList: any): void {\n    const trips = list(tripList.Trip);\n\n    for (const trip of trips) {\n      trip.Leg = list(trip.Leg);\n      for (const leg of trip.Leg) {\n        if (leg.Origin.Notes) {\n          leg.Origin.Notes.Note = list(leg.Origin.Notes.Note);\n        }\n        if (leg.Destination.Notes) {\n          leg.Destination.Notes.Note = list(leg.Destination.Notes.Note);\n        }\n      }\n    }\n\n    setSearchingState(false);\n    setTripsState(trips);\n  }\n\n  function findEarlierTrips() {\n    const newDate = dayjs(dateState)\n      .subtract(20, \"minute\")\n      .toDate();\n    setDateState(newDate);\n    search(newDate);\n  }\n\n  function findLaterTrips() {\n    const newDate = dayjs(dateState)\n      .add(20, \"minute\")\n      .toDate();\n    setDateState(newDate);\n    search(newDate);\n  }\n\n  return (\n    <React.StrictMode>\n      <div className=\"app\">\n        <nav className=\"app__nav-bar\">\n          <button onClick={handleNavBarClick}>\n            <FontAwesome name=\"bus\" />\n            Reaktiv Västtrafik\n          </button>\n        </nav>\n        {renderMainContent()}\n      </div>\n    </React.StrictMode>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/App\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"app-root\"));\n\nserviceWorker.register();\n"],"sourceRoot":""}