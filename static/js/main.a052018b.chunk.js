(this["webpackJsonpvt-react"]=this["webpackJsonpvt-react"]||[]).push([[0],[,,,,,,function(e,t,n){e.exports={legs:"TripDetails_legs__3EAG4",leg:"TripDetails_leg__3RYui",direction:"TripDetails_direction__nETYo",track:"TripDetails_track__3u51Y",overview:"TripDetails_overview__3QAnu",location:"TripDetails_location__3weSf",time:"TripDetails_time__3LcKt",name:"TripDetails_name__3k2bV",notes:"TripDetails_notes__2gw9C"}},function(e,t,n){e.exports={overview:"TripOverview_overview___kW70",origin:"TripOverview_origin__1YlZ5",destination:"TripOverview_destination__guSIV",invalid:"TripOverview_invalid__1q6Bi",notesIcon:"TripOverview_notesIcon__1nrtU",legs:"TripOverview_legs__1MaC0",travelTime:"TripOverview_travelTime__18eQF",leg:"TripOverview_leg__15Ba1"}},,function(e,t,n){e.exports={locations:"SearchBar_locations__CSxHQ",datetime:"SearchBar_datetime__2SP0R",search:"SearchBar_search__22_iH",switchLocationsButton:"SearchBar_switchLocationsButton__1Gqfa",switchLocationsIcon:"SearchBar_switchLocationsIcon__1eBNU",searchButton:"SearchBar_searchButton__1GItM",spinnerIcon:"SearchBar_spinnerIcon__2MG7m",searching:"SearchBar_searching__8o1tj"}},,,,,,function(e,t,n){e.exports={app:"App_app__1tA9O",navbar:"App_navbar__2AN66",logo:"App_logo__3qVxm",error:"App_error__yS4ld"}},function(e,t,n){e.exports={wrapper:"LocationSearchInput_wrapper__2djFY",icon:"LocationSearchInput_icon__1yItC",input:"LocationSearchInput_input__2QYj6",cancelButton:"LocationSearchInput_cancelButton__392il"}},,,,function(e,t,n){e.exports={wrapper:"DatetimeInput_wrapper__XqBGi",nowButton:"DatetimeInput_nowButton__23SMg",nowOverlay:"DatetimeInput_nowOverlay__1vweV"}},function(e,t,n){e.exports={wrapper:"Input_wrapper__2o0fD",input:"Input_input__24dvw",inputIcon:"Input_inputIcon__3Fr-L"}},function(e,t,n){e.exports={wrapper:"LocationInput_wrapper__22Kag",fakeInput:"LocationInput_fakeInput__2YPHy",static:"LocationInput_static__2Xnyu"}},function(e,t,n){e.exports={earlierLaterButtons:"SearchResult_earlierLaterButtons__2UOOe",earlierLaterButton:"SearchResult_earlierLaterButton__15iUV"}},,,function(e,t,n){e.exports={search:"LocationSearch_search__nxx0-",results:"LocationSearch_results__ypv_A"}},,,function(e,t,n){e.exports={address:"Location_address__1BjE9"}},function(e,t,n){e.exports={list:"LocationList_list__1GHD9"}},function(e,t,n){e.exports={item:"LocationListItem_item__LweBU"}},function(e,t,n){e.exports={list:"TripList_list__UIk8G"}},function(e,t,n){e.exports={item:"TripListItem_item__104lt"}},,function(e,t,n){e.exports=n(48)},,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(17),i=n.n(o),c=n(8),s=n.n(c),l=n(12),u=n(14),m=n(2),p=n(4),f=n(3),d=n(5),v=n.n(d);function h(){return(h=Object(u.a)(s.a.mark((function e(t,n){var a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="https://api.vasttrafik.se/bin/rest.exe/v2/location.name?format=json&input="+encodeURIComponent(n),e.next=3,fetch(a,{headers:new Headers({Authorization:"Bearer "+t}),method:"GET"});case 3:return r=e.sent,e.abrupt("return",r.json());case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,n,a){return g.apply(this,arguments)}function g(){return(g=Object(u.a)(s.a.mark((function e(t,n,a,r){var o,i,c,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=v()(r).format("YYYY-MM-DD"),i=v()(r).format("HH:mm"),c="https://api.vasttrafik.se/bin/rest.exe/v2/trip?format=json"+w("origin",n)+w("dest",a)+"&date="+encodeURIComponent(o)+"&time="+encodeURIComponent(i),e.next=5,fetch(c,{headers:new Headers({Authorization:"Bearer "+t}),method:"GET"});case 5:return l=e.sent,e.abrupt("return",l.json());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return t.id?"&"+e+"Id="+encodeURIComponent(t.id):t.lat&&t.lon?"&"+e+"CoordName="+encodeURIComponent(t.name)+"&"+e+"CoordLat="+encodeURIComponent(t.lat)+"&"+e+"CoordLong="+encodeURIComponent(t.lon):""}var E=n(18),k=n(19),b=function(){function e(t,n){Object(E.a)(this,e),this.key=void 0,this.secret=void 0,this.token=void 0,this.key=t,this.secret=n,this.token={expiryDate:0,token:""}}return Object(k.a)(e,[{key:"getToken",value:function(){var e=this;return new Promise((function(t,n){var a=e.getStoredToken();Date.now()<a.expiryDate?t(a.token):e.signIn().then((function(e){return e.json()})).then((function(n){e.token={expiryDate:Date.now()+1e3*Number(n.expires_in),token:n.access_token},e.storeToken(),t(e.token.token)}))}))}},{key:"getStoredToken",value:function(){return{expiryDate:Number(localStorage.getItem("tokenExpiryDate")),token:localStorage.getItem("token")}}},{key:"signIn",value:function(){var e=new Headers({Authorization:"Basic "+btoa(this.key+":"+this.secret),"Content-Type":"application/x-www-form-urlencoded"});return fetch("https://api.vasttrafik.se:443/token",{body:"grant_type=client_credentials&scope="+this.scope(),headers:e,method:"POST"})}},{key:"scope",value:function(){var e=localStorage.getItem("scope");return e||(e=this.generateScope(),localStorage.setItem("scope",e)),e}},{key:"generateScope",value:function(){return Math.random().toString(36).slice(2)}},{key:"storeToken",value:function(){localStorage.setItem("token",this.token.token),localStorage.setItem("tokenExpiryDate",String(this.token.expiryDate))}}]),e}();function N(e,t){var n=Object(a.useState)((function(){return window.localStorage.getItem(e)?JSON.parse(window.localStorage.getItem(e)):t})),r=Object(m.a)(n,2),o=r[0],i=r[1];return[o,function(t){i(t),window.localStorage.setItem(e,JSON.stringify(t))}]}var S="d9k7BQPB7_5nIsjU9d7Y0IkFIqUa",y="Ksgx8WdEnn9gjp9Sqln72WgbQdUa";function L(e){return e?Array.isArray(e)?e:[e]:[]}function O(e){return e<10?"0"+e:""+e}var I=n(15),C=n.n(I),j=n(10),T=n.n(j),x=n(20),B=n.n(x),D=n(21),U=n.n(D),A=function(e){return r.a.createElement("div",{className:U.a.wrapper},r.a.createElement(f.a,{className:U.a.inputIcon,icon:e.icon}),r.a.createElement("input",Object.assign({className:U.a.input},e)))},R=function(e){var t=e.date,n=e.now,a=e.onChange,o=e.onNowButtonClick,i=v()(t).format("YYYY-MM-DDTHH:mm:ss");return r.a.createElement("div",{className:B.a.wrapper},r.a.createElement(A,{icon:p.c,type:"datetime-local",value:i,onChange:function(e){var t=e.target;a(v()(t.value).toDate())}}),n?r.a.createElement("div",{className:B.a.nowOverlay},"Avg\xe5r nu"):r.a.createElement("button",{className:B.a.nowButton,onClick:o},"Nu"))},M=n(28),Y=n(29),W=n.n(Y),H=function(e){var t=e.name.split(", "),n=Object(m.a)(t,2),a=n[0],o=n[1];return r.a.createElement("div",null,r.a.createElement("div",null,a),o&&r.a.createElement("div",{className:W.a.address},o))},P=n(22),G=n.n(P),F=n(34),q=function(){function e(t){Object(E.a)(this,e),this.items=void 0,this.limit=void 0,this.limit=t;var n=localStorage.getItem("mru");this.items=n?JSON.parse(n):[]}return Object(k.a)(e,[{key:"add",value:function(e){this.removeExistingItem(e),this.items.unshift(e),this.ensureLengthWithinLimit(),this.setMostRecentlyUsed()}},{key:"getMostRecentlyUsed",value:function(){return this.items}},{key:"setMostRecentlyUsed",value:function(){localStorage.setItem("mru",JSON.stringify(this.items))}},{key:"getFirstMatch",value:function(e){return this.items.find((function(t){return t.name.toLowerCase().startsWith(e.toLowerCase())}))}},{key:"removeExistingItem",value:function(e){var t=this.items.findIndex((function(t){return t.id===e.id}));t>-1&&this.items.splice(t,1)}},{key:"ensureLengthWithinLimit",value:function(){this.items.length>this.limit&&this.items.splice(this.limit,this.items.length-this.limit)}}]),e}(),J=n(30),Q=n.n(J),V=n(31),K=n.n(V),z=function(e){var t=e.location,n=e.onClick;return r.a.createElement("li",{className:K.a.item,onClick:function(e){e.stopPropagation(),n(t)}},r.a.createElement(H,{name:t.name}))},X=function(e){var t=e.locations,n=e.onSelect;return r.a.createElement("ul",{className:Q.a.list},t.map((function(e){return r.a.createElement(z,{location:e,key:e.id||e.name,onClick:n})})))},$=n(26),Z=n.n($),ee=n(16),te=n.n(ee),ne=function(e){var t=e.value,n=e.onChange,a=e.onCancel;return r.a.createElement("div",{className:te.a.wrapper},r.a.createElement("div",{className:te.a.icon},r.a.createElement(f.a,{icon:p.f})),r.a.createElement("input",{className:te.a.input,placeholder:"Station",ref:function(e){setTimeout((function(){e&&e.focus()}),0)},type:"text",value:t,onChange:n}),r.a.createElement("button",{className:te.a.cancelButton,onClick:a},"Avbryt"))},ae=function(e){var t=e.onCancel,n=e.onSelect,o=new q(10),i=Object(a.useState)(o.getMostRecentlyUsed()),c=Object(m.a)(i,2),s=c[0],u=c[1],p=Object(a.useState)(""),f=Object(m.a)(p,2),d=f[0],v=f[1],_=Object(a.useState)(),g=Object(m.a)(_,2),w=g[0],E=g[1],k=function(e,t){var n=Object(a.useState)(e),r=Object(m.a)(n,2),o=r[0],i=r[1];return Object(a.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),o}(d,250);function N(e){n(e),e.id&&o.add(e)}return Object(a.useEffect)((function(){k&&new b(S,y).getToken().then((function(e){(function(e,t){return h.apply(this,arguments)})(e,k).then((function(e){var t=function(e,t,n){for(var a=[],r=0,o=0;r<e.length&&o<t.length;)a.push(n(e[r],t[o])<=0?e[r++]:t[o++]);for(;r<e.length;)a.push(e[r++]);for(;o<t.length;)a.push(t[o++]);return a}(L(e.LocationList.CoordLocation),L(e.LocationList.StopLocation),(function(e,t){return Number(e.idx)-Number(t.idx)}));u(t)}))}))}),[k]),r.a.createElement("div",{className:Z.a.search},r.a.createElement(ne,{value:d,onChange:function(e){var t=e.target.value;v(t),E(o.getFirstMatch(t)),t||u(o.getMostRecentlyUsed())},onCancel:function(e){e.stopPropagation(),t()}}),function(){if(!s.length&&!w)return null;var e=w?function(e,t){var n,a=[],r=new Set,o=Object(l.a)(e);try{for(o.s();!(n=o.n()).done;){var i=n.value,c=t(i);r.has(c)||a.push(i),r.add(c)}}catch(s){o.e(s)}finally{o.f()}return a}([w].concat(Object(F.a)(s)),(function(e){return e.id||e.name})):s;return r.a.createElement("div",{className:Z.a.results},r.a.createElement(X,{locations:e,onSelect:N}))}())},re=(n(46),function(e){var t=e.children,n=document.createElement("div");return Object(a.useEffect)((function(){var e=document.getElementsByTagName("body")[0],t=document.getElementById("modal-root");return e.classList.add("noscroll"),n.classList.add("modal"),t.appendChild(n),function(){e.classList.remove("noscroll"),t.removeChild(n)}}),[n]),i.a.createPortal(t,n)}),oe=function(e){var t=e.disabled,n=e.selected,o=e.onSelect,i=Object(a.useState)(!1),c=Object(m.a)(i,2),s=c[0],l=c[1],u=n.name;function p(){l(!1)}function f(e){l(!1),o(e)}return r.a.createElement("div",{className:G.a.wrapper},s&&r.a.createElement(re,null,r.a.createElement(ae,{onCancel:p,onSelect:f})),u&&r.a.createElement(H,{name:u}),r.a.createElement("input",{type:"text",className:T()(G.a.fakeInput,Object(M.a)({},G.a.static,!u)),onFocus:function(){l(!t)},placeholder:u?"":"H\xe5llplats"}))},ie=n(9),ce=n.n(ie),se=function(e){var t=e.origin,n=e.dest,a=e.date,o=e.now,i=e.searching,c=e.onDatetimeChange,s=e.onLocationChange,l=e.onLocationSwitch,u=e.onNowButtonClick,m=e.onSearch;return r.a.createElement("div",null,r.a.createElement("div",{className:ce.a.locations},r.a.createElement("div",{className:ce.a.inputs},r.a.createElement(oe,{disabled:i,selected:t,onSelect:function(e){s("origin",e)}}),r.a.createElement(oe,{disabled:i,selected:n,onSelect:function(e){s("dest",e)}})),r.a.createElement("button",{className:ce.a.switchLocationsButton,onClick:l},r.a.createElement(f.a,{className:ce.a.switchLocationsIcon,icon:p.d,rotation:90}))),r.a.createElement("div",{className:ce.a.datetime},r.a.createElement(R,{date:a,now:o,onChange:c,onNowButtonClick:u})),r.a.createElement("button",{className:ce.a.searchButton,onClick:function(){m()},disabled:i},i?r.a.createElement("span",null,"S\xf6ker...",r.a.createElement(f.a,{className:T()(ce.a.spinnerIcon,"right-icon"),icon:p.g,spin:!0})):r.a.createElement("span",null,"S\xf6k resa")))},le=n(23),ue=n.n(le),me=n(32),pe=n.n(me),fe=n(6),de=n.n(fe),ve=function(e){var t=e.trip;function n(e){return r.a.createElement("div",{className:de.a.location},r.a.createElement("div",{className:de.a.overview},r.a.createElement("div",{className:de.a.time},e.time),r.a.createElement("div",{className:de.a.name},e.name),r.a.createElement("div",{className:de.a.track},e.track&&"L\xe4ge "+e.track)),e.Notes&&r.a.createElement("ul",{className:de.a.notes},e.Notes.Note.map((function(e,t){return r.a.createElement("li",{key:t},e.$)}))))}return r.a.createElement("ul",{className:de.a.legs},t.Leg.filter((function(e){return"WALK"!==e.type})).map((function(e,t){return function(e,t){return r.a.createElement("li",{className:de.a.leg,key:t},n(e.Origin),r.a.createElement("div",{className:de.a.direction},e.name," mot ",e.direction),n(e.Destination))}(e,t)})))},he=n(33),_e=n.n(he),ge=n(7),we=n.n(ge),Ee=function(e){var t,n=e.trip,a=e.onClick,o=(t=n.Leg,t[0]).Origin,i=function(e){return e[e.length-1]}(n.Leg).Destination;function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return[r.a.createElement("span",{key:0},null!==(t=e.rtTime)&&void 0!==t?t:e.time,n&&r.a.createElement(f.a,{className:T()(we.a.notesIcon,"right-icon"),icon:p.e})),e.rtTime&&e.time!==e.rtTime&&r.a.createElement("s",{className:T()(we.a.time,we.a.invalid),key:1},e.time)]}return r.a.createElement("div",{className:we.a.overview,onClick:a},r.a.createElement("div",{className:we.a.origin},r.a.createElement("div",null,c(o,n.Leg.some((function(e){return e.Origin.Notes||e.Destination.Notes})))),r.a.createElement("div",{className:we.a.legs},n.Leg.filter((function(e){return e.sname})).map((function(e,t){return function(e,t){return r.a.createElement("span",{className:we.a.leg,key:t,style:{backgroundColor:e.fgColor,borderColor:"#ffffff"===e.fgColor?"#EE1844":"transparent",color:e.bgColor}},e.sname)}(e,t)})))),r.a.createElement(f.a,{icon:p.a}),r.a.createElement("div",{className:we.a.destination},r.a.createElement("div",null,c(i)),r.a.createElement("div",{className:we.a.travelTime},"Restid: ",function(e,t){var n=v()("".concat(e.rtDate||e.date," ").concat(e.rtTime||e.time)),a=v()("".concat(t.rtDate||t.date," ").concat(t.rtTime||t.time)),r=a.diff(n,"hour"),o=a.diff(n,"minute")%60;return O(r)+":"+O(o)}(o,i))))},ke=function(e){var t=e.trip,n=Object(a.useState)(!1),o=Object(m.a)(n,2),i=o[0],c=o[1];return r.a.createElement("div",{className:_e.a.item},r.a.createElement(Ee,{trip:t,onClick:function(){c(!i)}}),i&&r.a.createElement(ve,{trip:t}))},be=function(e){var t=e.trips;return r.a.createElement("ul",{className:pe.a.list},t.map((function(e,t){return r.a.createElement("li",{key:t},r.a.createElement(ke,{trip:e}))})))},Ne=function(e){return r.a.createElement("div",null,r.a.createElement(be,{trips:e.trips}),r.a.createElement("div",{className:ue.a.earlierLaterButtons},r.a.createElement("button",{className:ue.a.earlierLaterButton,onClick:e.onShowEarlier},"Tidigare"),r.a.createElement("button",{className:ue.a.earlierLaterButton,onClick:e.onShowLater},"Senare")))},Se=function(e){return r.a.createElement("div",{className:C.a.error},e.error)},ye=function(){var e=new b(S,y),t=N("trips",[]),n=Object(m.a)(t,2),o=n[0],i=n[1],c=N("origin",{name:""}),d=Object(m.a)(c,2),h=d[0],g=d[1],w=N("dest",{name:""}),E=Object(m.a)(w,2),k=E[0],O=E[1],I=Object(a.useState)(new Date),j=Object(m.a)(I,2),T=j[0],x=j[1],B=Object(a.useState)(""),D=Object(m.a)(B,2),U=D[0],A=D[1],R=Object(a.useState)(!0),M=Object(m.a)(R,2),Y=M[0],W=M[1],H=Object(a.useState)(!1),P=Object(m.a)(H,2),G=P[0],F=P[1];function q(e){x(e),W(!1)}function J(e,t){switch(e){case"dest":O(t);break;case"origin":g(t);break;default:throw new Error("Unknown input name: "+e)}}function Q(){W(!0)}function V(){var e=k;O(h),g(e)}function K(){var e=T;Y&&(e=new Date,x(e)),z(e)}function z(e){return X.apply(this,arguments)}function X(){return(X=Object(u.a)(s.a.mark((function t(n){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=n||T,A(""),F(!0),i([]),t.prev=4,t.next=7,e.getToken();case 7:return a=t.sent,t.t0=$,t.next=11,_(a,h,k,n);case 11:t.t1=t.sent,(0,t.t0)(t.t1),t.next=18;break;case 15:t.prev=15,t.t2=t.catch(4),Z("N\xe5gonting gick snett.");case 18:case"end":return t.stop()}}),t,null,[[4,15]])})))).apply(this,arguments)}function $(e){var t=e.TripList;t.error?Z("Inga resultat funna."):function(e){var t,n=L(e.Trip),a=Object(l.a)(n);try{for(a.s();!(t=a.n()).done;){var r=t.value;r.Leg=L(r.Leg);var o,c=Object(l.a)(r.Leg);try{for(c.s();!(o=c.n()).done;){var s=o.value;s.Origin.Notes&&(s.Origin.Notes.Note=L(s.Origin.Notes.Note)),s.Destination.Notes&&(s.Destination.Notes.Note=L(s.Destination.Notes.Note))}}catch(u){c.e(u)}finally{c.f()}}}catch(u){a.e(u)}finally{a.f()}F(!1),i(n)}(t)}function Z(e){A(e),F(!1)}function ee(){var e=v()(T).subtract(20,"minute").toDate();x(e),z(e)}function te(){var e=v()(T).add(20,"minute").toDate();x(e),z(e)}return r.a.createElement(r.a.StrictMode,null,r.a.createElement("div",{className:C.a.app},r.a.createElement("nav",{className:C.a.navbar},r.a.createElement("button",{onClick:function(){A(""),i([])}},r.a.createElement(f.a,{className:C.a.logo,icon:p.b}),"Reaktiv V\xe4sttrafik")),U?r.a.createElement(Se,{error:U}):o.length?r.a.createElement(Ne,{trips:o,onShowEarlier:ee,onShowLater:te}):r.a.createElement(se,{origin:h,dest:k,date:T,now:Y,searching:G,onDatetimeChange:q,onLocationChange:J,onLocationSwitch:V,onNowButtonClick:Q,onSearch:K})))},Le=(n(47),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function Oe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(r.a.createElement(ye,null),document.getElementById("app-root")),function(e){if("serviceWorker"in navigator){if(new URL("/vasttrafik-react",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/vasttrafik-react","/service-worker.js");Le?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Oe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Oe(t,e)}))}}()}],[[35,1,2]]]);
//# sourceMappingURL=main.a052018b.chunk.js.map